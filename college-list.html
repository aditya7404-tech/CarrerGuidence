<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Available Colleges - Career Guidance</title>

  <!-- Google Font + CSS -->
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <nav class="nav">
    <a href="index.html">üè† Home</a>
    <a href="login.html">Login</a>
    <a href="signup.html">Sign Up</a>
    <a href="admin.html">Admin</a>
  </nav>

  <main class="container">
    <h2>üéì Available Colleges</h2>
    <div id="collegeList">Loading colleges...</div>
  </main>

  <!-- Fixed Go Back Button -->
  <button onclick="history.back()" class="back-btn">‚¨Ö Go Back</button>

  <!-- Firebase Setup -->
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
  <script src="firebase-config.js"></script>

  <script>
    const auth = firebase.auth();
    const db = firebase.firestore();

    const collegeList = document.getElementById("collegeList");

    async function loadColleges() {
      try {
        const snapshot = await db.collection("colleges").get();
        if (snapshot.empty) {
          collegeList.innerHTML = "<p>No colleges available yet.</p>";
          return;
        }

        collegeList.innerHTML = "";
        snapshot.forEach((doc) => {
          const data = doc.data();
          const div = document.createElement("div");
          div.className = "college-card";
          div.innerHTML = `
            <h3>${data.name}</h3>
            <p><strong>Location:</strong> ${data.location}</p>
            <p><strong>Fees:</strong> ‚Çπ${data.fees}</p>
            <p><strong>Eligibility:</strong> ${data.eligibility}</p>
            <button onclick="registerCollege('${doc.id}')">Register</button>
          `;
          collegeList.appendChild(div);
        });
      } catch (error) {
        console.error("Error loading colleges:", error);
        collegeList.innerHTML = "<p>Error loading colleges. Check console.</p>";
      }
    }

    async function registerCollege(id) {
      const user = auth.currentUser;
      if (!user) {
        alert("Please login first!");
        return;
      }
      try {
        await db.collection("users").doc(user.uid).set(
          { selectedCollege: id },
          { merge: true }
        );
        alert("College registered successfully ‚úÖ");
      } catch (error) {
        alert("Error registering college: " + error.message);
      }
    }

    // Load colleges on page load
    loadColleges();
  </script>
</body>
</html>
